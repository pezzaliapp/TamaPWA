<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TamaPWA ‚Äî Debug Min</title>
<style>
  *{box-sizing:border-box} body{font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;margin:0;background:#0e0f12;color:#eaeaf0}
  main{width:min(900px,100%);margin:0 auto;padding:14px}
  h1{font-size:18px;margin:10px 0}
  #pet{position:relative;display:grid;place-items:center;width:min(60vw,320px);aspect-ratio:1/1;margin:12px auto;background:#101826;border:1px solid #2b2f3a;border-radius:12px}
  #pet span{font-size:clamp(28px,10vw,56px)}
  .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:10px 0}
  button{padding:10px 14px;border-radius:10px;border:1px solid #2b2f3a;background:#202432;color:#eaeaf0;cursor:pointer;font-weight:600}
  /* mini game area */
  #area{position:relative;width:min(520px,95vw);height:320px;margin:12px auto;border:1px dashed #2b2f3a;border-radius:10px;background:#0f1320;overflow:hidden}
  .t{position:absolute;width:56px;height:56px;border-radius:50%;background:#7cf3a0;display:grid;place-items:center;font-weight:700;color:#0b1220;user-select:none;touch-action:manipulation}
  .t:active{transform:scale(.9)}
  #hud{display:flex;justify-content:space-between;align-items:center;width:min(520px,95vw);margin:0 auto}
</style>
</head>
<body>
  <main>
    <h1>TamaPWA ‚Äî Debug Min</h1>
    <div class="row">
      <button id="demo">‚è±Ô∏è Demo: OFF</button>
      <button id="play">üéØ Gioca</button>
      <button id="reset">‚ôªÔ∏è Reset</button>
    </div>

    <div id="pet"><span id="sprite">Ôºà„Éª‚äù„ÉªÔºâ</span></div>
    <p id="info" style="text-align:center;margin:0 0 8px">Et√†: <b id="age">0</b>g ‚Äî Umore: <b id="mood">Curioso</b> ‚Äî Stadio: <b id="stage">Uovo</b></p>

    <div id="hud"><div>Punti: <b id="pts">0</b></div><div>Tempo: <b id="t">0</b>s</div></div>
    <div id="area" aria-label="Area di gioco"></div>
  </main>

<script>
(() => {
  'use strict';
  const stateKey='tama_min_debug';
  const initial=()=>({createdAt:Date.now(),last:Date.now(),age:0,stage:'egg',h:80,ha:80,e:80,c:80});
  let S=load();

  const spriteEl = document.getElementById('sprite');
  const ageEl = document.getElementById('age');
  const stageEl = document.getElementById('stage');
  const moodEl = document.getElementById('mood');
  const demoBtn = document.getElementById('demo');
  const resetBtn = document.getElementById('reset');
  const playBtn = document.getElementById('play');

  let demo=false; demoBtn.onclick=()=>{ demo=!demo; demoBtn.textContent= demo?'‚è±Ô∏è Demo: ON':'‚è±Ô∏è Demo: OFF'; };

  resetBtn.onclick=()=>{ if(confirm('Reset?')){ S=initial(); save(); render(true);} };

  playBtn.onclick=()=> startGame();

  function tick(){
    const now=Date.now(), dt=(now-S.last)/1000; if(dt<=0){S.last=now;return;}
    const hoursPerDay = demo ? (1/60) : 24;
    const days = Math.floor((now - S.createdAt)/3600000 / hoursPerDay);
    if(days!==S.age){ S.age=days; updateStage(); }
    S.last=now; save(); render();
  }
  setInterval(tick, 500);

  function updateStage(){
    if (S.age<1) S.stage='egg';
    else if (S.age<3) S.stage='baby';
    else if (S.age<7) S.stage='teen';
    else S.stage='adult';
  }

  function render(first=false){
    ageEl.textContent=S.age;
    stageEl.textContent=({egg:'Uovo',baby:'Baby',teen:'Teen',adult:'Adult'})[S.stage];
    const avg=(S.h+S.ha+S.e+S.c)/4; const mood=avg>=75?'Felice':avg>=45?'Curioso':'Triste';
    moodEl.textContent=mood;
    if (!['‚òÖ','üí§','‚ú®','üçé'].includes(spriteEl.textContent)){
      const faces={egg:{happy:'(‚Ä¢Õà‚å£‚Ä¢Õà)Ô∏é',ok:'Ôºà„Éª‚äù„ÉªÔºâ',sad:'(„Éª„Å∏„Éª)'},baby:{happy:'(·µî·¥•·µî)',ok:'(‚Ä¢·¥ó‚Ä¢)',sad:'(„Éª_„Éª;)'},teen:{happy:'(Ôºæ‚ñΩÔºæ)',ok:'(„Éª‚àÄ„Éª)',sad:'(Ôø£„ÉòÔø£;)'},adult:{happy:'(Ôºæ‚ÄøÔºæ)',ok:'(„Éª‚Äø„Éª)',sad:'(ÔºõÔø£–îÔø£)'}}[S.stage];
      spriteEl.textContent=faces[mood==='Felice'?'happy':mood==='Curioso'?'ok':'sad']||'(„Éª‚Äø„Éª)';
    }
  }

  function save(){ localStorage.setItem(stateKey, JSON.stringify(S)); }
  function load(){ try{ const r=localStorage.getItem(stateKey); return r?Object.assign(initial(), JSON.parse(r)):initial(); }catch{ return initial(); } }

  // --------- Minimal Catch game (works everywhere) ---------
  const area = document.getElementById('area');
  const ptsEl = document.getElementById('pts');
  const tEl = document.getElementById('t');
  let timer=null, mover=null, left=0, topv=0, pts=0, time=0;
  function startGame(){
    // clear old
    clearInterval(timer); clearInterval(mover); area.innerHTML='';
    pts=0; time=15; ptsEl.textContent=pts; tEl.textContent=time;
    const target=document.createElement('div');
    target.className='t'; target.textContent='‚òÖ';
    target.style.left='0px'; target.style.top='0px';
    // robust hit handler
    const hit=()=>{ pts++; ptsEl.textContent=pts; move(true); };
    target.addEventListener('pointerdown', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); hit(); });
    target.addEventListener('click', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); hit(); });
    area.appendChild(target);
    move(true);

    mover=setInterval(()=>move(false), 600);
    timer=setInterval(()=>{
      time--; tEl.textContent=time;
      if(time<=0){ clearInterval(timer); clearInterval(mover); end(); }
    }, 1000);
  }
  function move(first){
    const t = area.querySelector('.t'); if(!t) return;
    const gw = area.clientWidth, gh = area.clientHeight;
    const tw = t.offsetWidth, th = t.offsetHeight;
    left = Math.random()*(gw-tw);
    topv = Math.random()*(gh-th);
    t.style.left = left+'px';
    t.style.top  = topv+'px';
    if(first && t.focus) t.focus();
  }
  function end(){
    alert('Fine! Punteggio: '+pts);
    // Ricompensa semplice
    S.ha = Math.min(100, S.ha + Math.min(5 + pts*2, 40));
    S.e  = Math.max(0,    S.e  - Math.max(2, Math.floor(pts/2)));
    save(); render();
  }

  // first paint
  render(true);
})();
</script>
</body>
</html>
